<% include('layout', { title: 'Home', user: user, body: '' }) %>

<% function renderBody(){ %>
  <h1>Available Food</h1>
  <form method="get" action="/">
    <input type="text" name="q" value="<%= q %>" placeholder="Search...">
    <button type="submit">Search</button>
  </form>

  <div style="display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:12px; margin-top:12px;">
    <% listings.forEach(item => { %>
      <div style="border:1px solid #ddd; border-radius:8px; padding:8px;">
        <% if (item.imageUrl) { %>
          <img src="<%= item.imageUrl %>" alt="<%= item.title %>" style="width:100%; height:160px; object-fit:cover; border-radius:6px;">
        <% } %>
        <h3><a href="/listing/<%= item._id %>"><%= item.title %></a></h3>
        <p><%= item.description %></p>
        <p>₹<%= item.price %> — <%= item.quantityAvailable %> left</p>
      </div>
    <% }) %>
  </div>

  <div style="margin-top:12px;">
    Page <%= meta.page %> of <%= meta.pages %> — Total <%= meta.total %>
    <% if (meta.page > 1) { %>
      <a href="/?q=<%= q %>&page=<%= meta.page -1 %>">Prev</a>
    <% } %>
    <% if (meta.page < meta.pages) { %>
      <a href="/?q=<%= q %>&page=<%= meta.page +1 %>">Next</a>
    <% } %>
  </div>
<% } %>

<%- renderBody() %>
